services:
  # Backend
  svc-airux8-optimize: &svc-airux8-optimize
    container_name: svc-airux8-optimize
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    working_dir: /app
    command: python -m uvicorn main:app --host=0.0.0.0 --port=8080 --reload
    networks:
      - menteru-net

    ports:
      - "8080:8080"

    restart: unless-stopped
    environment:
      # 開発環境変数
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
      - ALLOWED_TRIGGER_PREFIXES=00_InputData/Clea,00_InputData/IsetanMitsukoshi
      # Storage backend configuration (local or gcs)
      - STORAGE_BACKEND=local
      - LOCAL_DATA_ROOT=/app/data
      - PROJECT_ID=airux8-opti-logic
      - BUCKET_NAME=airux8-opti-logic-prod
      - GOOGLE_APPLICATION_CREDENTIALS=/app/config/svc-airux8-optimize-key.json

networks:
  menteru-net:
    driver: bridge
